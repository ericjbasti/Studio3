"use strict";function setupPool(t){if(!(t>=0))throw"setupPool takes a size >= 0 as argument.";for(this.pool=this.pool||[],this.poolSize=this.poolSize||0,this.pnew=pnew,Object.defineProperty?Object.defineProperty(this.prototype,"pdispose",{value:pdispose}):Object.prototype.pdispose=pdispose;this.poolSize<t;)(new this).pdispose();this.poolSize>t&&(this.poolSize=t,this.pool.length=t)}function pnew(){var t=null;return 0!==this.poolSize?(this.poolSize--,t=this.pool[this.poolSize],this.pool[this.poolSize]=null):t=new this,this.apply(t,arguments),t}function pdispose(){var t=this.constructor;this.dispose&&this.dispose(),t.pool[t.poolSize++]=this}if(!window.console)var console={log:function(){},warn:function(){}};Object.keys||(console.warn("This browser does not support Object.keys() . Using polyfill instead."),Object.keys=function(){var t=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=e.length;return function(o){if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var h=[],n,r;for(n in o)t.call(o,n)&&h.push(n);if(i)for(r=0;s>r;r++)t.call(o,e[r])&&h.push(e[r]);return h}}()),"function"!=typeof Object.create&&(console.warn("This browser does not support Object.create() . Using polyfill instead."),Object.create=function(){var t=function(){};return function(i){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof i)throw new TypeError("Argument must be an object");t.prototype=i;var e=new t;return t.prototype=null,e}}()),function(){for(var t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.warn("This browser does not support requestAnimationFrame() . Using setTimeout() instead."),window.requestAnimationFrame=function(t){var i=window.setTimeout(function(){t(Date.now())},1e3/30);return i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),Object.defineProperty?Object.defineProperty(Function.prototype,"setupPool",{value:setupPool}):Function.prototype.setupPool=setupPool,window.Studio||(window.Studio={stages:[],stage:null,tko:null,assets:{length:0},queue:0,progress:0,sin:Math.sin,cos:Math.cos,random:Math.random,abs:Math.abs,my:{ratio:1},temp:{},info:{displayObjects:0},active:!0,cap:34,draws:0,loaded:!0,version:"0.5.1",now:0,delta:0},Studio.time=1,Studio.interval=null,Studio.browser=navigator.userAgent.toLowerCase(),Studio.disableRAF=!1,Studio.RAF),Studio.updateProgress=function(){this.progress=this.queue/this.assets.length},Studio.addAsset=function(t,i){return this.assets[t]?(console.warn("Already loaded : ",t,Studio.assets[i]),!1):(this.assets.length+=1,this.assets[t]=new i,this.updateProgress(),!0)},Studio.start=function(t){Studio.queue===Studio.assets.length&&(Studio.progress=1),t?(Studio.now=t,Studio.time=t,Studio.RAF=requestAnimationFrame(Studio.loop)):Studio.RAF=requestAnimationFrame(Studio.start)},Studio.loop=function(t){Studio.RAF=requestAnimationFrame(Studio.loop),Studio.tick(t),Studio.draws=0,Studio.stage.loop(Studio.delta)},Studio.capped=function(t){this.delta=t-this.now,this.now=t,this.delta=this.cap>this.delta?this.delta:this.cap},Studio.uncapped=function(t){this.delta=t-this.now,this.now=t},Studio.tick=Studio.uncapped,Studio.stopTime=function(){},Studio.resetTime=function(){},Studio.handleVisibilityChange=function(){document.hidden?(console.log("%cStudio Paused (visibilitychange)",Studio.statStyle),cancelAnimationFrame(Studio.RAF)):(console.log("%cStudio Play (visibilitychange)",Studio.statStyle),Studio.RAF=requestAnimationFrame(Studio.start))},document.addEventListener("visibilitychange",Studio.handleVisibilityChange,!1),Studio.z_index=function(t,i){return t.z<i.z?-1:t.z>i.z?1:0},Studio.round=function(t){return t+.5|0},Studio.apply=function(t){for(Studio.temp.keys=Object.keys(t),Studio.temp.keys_i=Studio.temp.keys.length;Studio.temp.keys_i;)Studio.temp.key=Studio.temp.keys[Studio.temp.keys_i-1],this[Studio.temp.key]=t[Studio.temp.key],Studio.temp.keys_i--;return this},Studio.addTo=function(t,i){for(var e in i)i.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=i[e])},Studio.extend=function(t,i){t.prototype=new i,t.prototype.constructor=t},Studio.Messanger=function(){this.listeners=[],this.status=0},Studio.Messanger.prototype.addListener=function(t){this.listeners.push(t),t(this.status)},Studio.Messanger.prototype.setStatus=function(t){this.status=t;for(var i=0;i<this.listeners.length;i++)this.listeners[i](this.status)},Studio.TOP=Studio.LEFT=0,Studio.MIDDLE=Studio.CENTER=.5,Studio.BOTTOM=Studio.RIGHT=1,Studio.infoStyle="background-color: #3af; padding: 2px 4px; color: #fff",Studio.errorStyle="background-color: #c01; padding: 2px 4px;",Studio.warningStyle="background-color: #fd2; padding: 2px 4px;",Studio.statStyle="background-color: #eee; padding: 2px 4px; color: #555; font-size: 10px",Studio.engineStyle="background-color: #eee; color: #3af; padding: 1px 4px; border: 1px solid #3af",Studio.Box=function(t,i,e,s){return this.left=t||0,this.top=i||0,this.right=t+e||1,this.bottom=i+s||1,this},Studio.Box.prototype={constructor:Studio.Box,set:function(t,i,e,s){this.left=t||this.left,this.top=i||this.top,this.right=t+e||this.right,this.bottom=i+s||this.bottom},get_bounds:function(t){this.get_straight_bounds(t)},get_straight_bounds:function(t){this.left=t._dx-t._world.width*t.anchorX,this.right=this.left+t._world.width,this.top=t._dy-t._world.height*t.anchorY,this.bottom=this.top+t._world.height},get_rotated_bounds:function(t){this.left=t._world.x-t._world.width*t.anchorX*2,this.right=this.left+3*t._world.width,this.top=t._world.y-t._world.height*t.anchorY*3,this.bottom=this.top+2*t._world.height}},Studio.Color=function(t,i,e,s){return this.r=t/255||0,this.g=i/255||0,this.b=e/255||0,this.a=s||1,this.style="rgba(255,255,255,1)",this._build_style(),this},Studio.Color.prototype={constructor:Studio.Color,set:function(t,i,e,s){return this.r=t/255,this.g=i/255,this.b=e/255,this.a=s,this._build_style(),this},red:function(t){return this.r=t,this},green:function(t){return this.g=t,this},blue:function(t){return this.b=t,this},alpha:function(t){return this.a=t,this},build:function(){return this._build_style(),this},setFromHex:function(t){return 4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff"),7===t.length&&(t+="ff"),this.set("0x"+t[1]+t[2]|0,"0x"+t[3]+t[4]|0,"0x"+t[5]+t[6]|0,("0x"+t[7]+t[8]|0)/255),this},_build_style:function(){this.style="rgba("+parseInt(255*this.r)+","+parseInt(255*this.g)+","+parseInt(255*this.b)+","+this.a+")"}},Studio.RED=new Studio.Color(204,0,17,1),Studio.YELLOW=new Studio.Color(255,221,34,1),Studio.BLUE=new Studio.Color(51,170,255,1),Studio.DisplayProperty=function(){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.angle=0,this.alpha=1,this.speed=1},Studio.DisplayProperty.prototype={constructor:Studio.DisplayProperty,apply:Studio.apply};var LinkedList=function(){this.first=null,this.last=null,this.length=0};LinkedList.prototype={add:function(t){return t.parent=this.parent,this.length++,this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},insert:function(t,i){this.length++,t.prev=i,i!==this.last?i.next=t:(this.last=t,t.next=this.first)},init:function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.length=0},remove:function(t){return 1===this.length?(this.init(),t.next=null,void(t.prev=null)):(this.first===t?this.first=this.first.next:this.last===t&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=null,t.prev=null,null===this.first&&(this.last=null),void this.length--)},update:function(t,i){for(var e=this.first;e;)this.next=e.next,e.update(t,i),e=e.next||this.next},render:function(t,i){for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},action:function(t){for(var i=this.first;i;)this.next=i.next,i[t](),i=i.next||this.next},removeAll:function(t){for(var i=this.first;i;)this.next=i.next,this.pdispose&&this.pdispose(),this.remove(i),i=i.next||this.next;i=null,t&&this.add(t)},toString:function(){for(var t=this.first,i="linked list : [";t;)i+=t,t=t.next;i+="];"},constructor:LinkedList},Studio.Plugin=function(t){this.init=null,this.options={},this.action=null,this.apply(t)},Studio.Plugin.constructor=Studio.Plugin,Studio.Plugin.prototype.apply=Studio.apply,Studio.Plugin.prototype._options=function(t){for(var i in t)this.options[i]=t[i]},Studio.Image=function(t){this.image=null,this.path=null,t&&this.loadImage(t),this.status=new Studio.Messanger},Studio.Image.prototype.constructor=Studio.Image,Studio.Image.prototype.ready=!1,Studio.Image.prototype.height=1,Studio.Image.prototype.width=1,Studio.Image.prototype.loadImage=function(t){if(Studio.assets[t])return console.warn("Already loaded : ",t,Studio.assets[t]),this.image=Studio.assets[t],this.ready=!0,this.status.setStatus(this.ready),this;Studio.assets[t]=new Image,Studio.assets.length++;var i=this;Studio.assets[t].onload=function(){return Studio.queue++,Studio.progress=Studio.queue/Studio.assets.length,i.ready=!0,i.status.setStatus(i.ready),i.height=this.height,i.width=this.width,Studio.queue===Studio.assets.length&&(Studio.loaded=!0),i},Studio.assets[t].src=t,this.image=Studio.assets[t]},Studio.Cache=function(t,i,e){var e=e||1;this.image=document.createElement("canvas"),this.image.width=t*e||512,this.image.height=i*e||512,this.width=t,this.height=i,this.ready=!1,this.buffer=this.image.getContext("2d"),this.buffer.scale(e,e)},Studio.extend(Studio.Cache,Studio.Image),Studio.Ease={},Studio.Ease.linear=function(t){return t},Studio.Ease.snap=function(t){return t+.5|0},Studio.Ease.chillInOut=function(t){var i=.75;return(t*=2)<1?.5*(t*t*((i+1)*t-i)):.5*((t-=2)*t*((i+1)*t+i)+2)},Studio.Ease.backOut=function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},Studio.Ease.bounceOut=function(t){return.363636>t?7.5625*t*t:.727272>t?7.5625*(t-=.545454)*t+.75:.90909>t?7.5625*(t-=.818181)*t+.9375:7.5625*(t-=.959595)*t+.984375},Studio.Ease.elasticOut=function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||1>e?(e=1,i=s/4):i=s*Math.asin(1/e)/6.283,e*Math.pow(2,-10*t)*Math.sin(6.283*(t-i)/s)+1)},Studio.Ease.linearRandom=function(t){return Math.random()*t},Studio.Ease.random=function(){return Math.random()},Studio.Ease.quadIn=function(t){return t*t},Studio.Ease.quadOut=function(t){return t*(2-t)},Studio.Ease.quadInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Studio.DisplayObject=function(t){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.anchorX=.5,this.anchorY=.5,this.rotation=0,this.alpha=1,this.visible=1,this.speed=1,this.active=1,this.orbits=!0,this.orbit=0,this.inheritRotation=!0,this.orbit_speed=1,t&&this.apply(t),this._boundingBox=new Studio.Box,this._alpha=this.alpha,this._visible=this.alpha*this.visible,this.parent=null,this.hasChildren=0,this.__x=this._world.x,this.__y=this._world.y,this._dx=this._world.x,this._dy=this._world.y},Studio.DisplayObject.prototype={constructor:Studio.DisplayObject,_world:new Studio.DisplayProperty,blendmode:"source-over",apply:Studio.apply,__update_XY:!0,__update_SCALE:!0,__update_DIMENSIONS:!0,__update_SPEED:!0,__update_ALPHA:!0,__update_ROTATION:!0,addChild:function(t){return this.hasOwnProperty("children")||(this.children=[]),this.hasOwnProperty("_world")||(this._world=new Studio.DisplayProperty),t.hasOwnProperty("_world")||(t._world=new Studio.DisplayProperty),t.parent=this._world,this.children[this.hasChildren]=t,this.hasChildren++,this},addChildren:function(){for(var t=0;t!==arguments.length;t++)this.addChild(arguments[t]);return this},getChildByName:function(t){for(var i=0;i!==this.hasChildren;i++)if(this.children[i].name===t)return this.children[i];return null},_destroy:function(){for(var t in this)this.hasOwnProperty(t)||delete this[t]},_order:function(){this.children.sort(Studio.z_index)},draw:function(){},snapPixels:function(){this._dx=this._dx+.5|0,this._dy=this._dy+.5|0,this._height=this._height+.5|0,this._width=this._width+.5|0},hitTestPoint:function(t,i){return this._relativeX=t-this._world.x,this._relativeY=i-this._world.y,this.anchoredX=this.anchorX*this._world.width,this.anchoredY=this.anchorY*this._world.height,this._relativeX<-this.anchoredX&&this._relativeY<-this.anchoredY?!1:this._relativeX>this.width&&this._relativeY>this.height?!1:(this._world.rotation&&(t=this._relativeX*Math.cos(-this.angle)-this._relativeY*Math.sin(-this.angle),i=this._relativeX*Math.sin(-this.angle)+this._relativeY*Math.cos(-this.angle),this._relativeX=t,this._relativeY=i),this._relativeX>-this.anchoredX&&this._relativeY>-this.anchoredY&&this._relativeX<this._world.width-this.anchoredX&&this._relativeY<this._world.height-this.anchoredY?!0:!1)},vertex_children:function(t,i){if(this.hasChildren)for(var e=0;e!==this.hasChildren;e++)this.children[e].buildElement(t,i)},render_children:function(t,i){if(this.hasChildren)for(var e=0;e!==this.hasChildren;e++)this.children[e].render(t,i)},render:function(t,i){this._visible&&(this._delta(i),t.snap&&this.snapPixels(),this.draw(t.ctx),this.render_children(t,i)),this.onExitFrame&&this.onExitFrame()},update_children:function(t,i){if(this.hasChildren)for(var e=0;e!==this.hasChildren;e++)this.children[e].update(t,i)},update_visibility:function(){this._world.alpha=this.alpha*this.parent.alpha,this._visible=this._world.alpha*this.visible},setAlpha:function(t){this._world.alpha!==t.globalAlpha&&this._visible&&(t.globalAlpha=this._world.alpha),this.blendmode!==t.globalCompositeOperation&&this._visible&&(t.globalCompositeOperation=this.blendmode)},update_scale:function(){this._world.scaleX=this.parent.scaleX*this.scaleX,this._world.scaleY=this.parent.scaleY*this.scaleY},update_dimensions:function(){this._world.width=this.width*this._world.scaleX,this._world.height=this.height*this._world.scaleY},update_angle:function(){this.angle=this._world.rotation/180*3.14159265},update_speed:function(){this._world.speed=this.speed*this.parent.speed},orbitXY:function(){var t=this.x*this._world.scaleX,i=this.y*this._world.scaleY,e=Studio.sin((this.parent.angle+this.orbit)*this.orbit_speed),s=Studio.cos((this.parent.angle+this.orbit)*this.orbit_speed);this._orbitX=t*s-i*e,this._orbitY=t*e+i*s},update_rotation:function(){this.inheritRotation?this._world.rotation=this.parent.rotation+this.rotation:this._world.rotation=this.rotation,this._world.rotation?this.update_angle():this.angle=0},update_orbit_xy:function(){this.orbitXY(),this._world.x=this._orbitX+this.parent.x,this._world.y=this._orbitY+this.parent.y},update_xy:function(){this.orbits&&this.parent.angle?this.update_orbit_xy():(this._world.x=this.x*this.parent.scaleX+this.parent.x,this._world.y=this.y*this.parent.scaleY+this.parent.y)},snapshot:function(){this.__x=this._world.x,this.__y=this._world.y,this._world.rotation&&(this._world.angle=this.angle)},__delta:function(t,i,e){return t+(i-t)*e},_delta:function(t){this._dx=this.__delta(this.__x,this._world.x,t),this._dy=this.__delta(this.__y,this._world.y,t),this._world.rotation&&(this._dAngle=this.__delta(this._world.angle,this.angle,t))},_snapback:function(){this.force_update()},force_update:function(){this.update_visibility(),this.update_scale(),this.update_speed(),this.update_dimensions(),this.update_rotation(),this.update_xy(),this.snapshot()},_update:function(){this.__update_ALPHA&&this.update_visibility(),this._visible&&(this.__update_SCALE&&this.update_scale(),this.__update_SPEED&&this.update_speed(),this.__update_DIMENSIONS&&this.update_dimensions(),this.__update_ROTATION&&this.update_rotation(),this.__update_XY&&this.update_xy(),this.update_children())},update:function(){this.snapshot(),this.onEnterFrame&&this.onEnterFrame(),this._update()}},Studio.DisplayList=function(t){this.cache=null,this.ctx=null,this.cached=!1,this.first=null,this.last=null,this.length=0,this.marked=[],this.autoCache=!0,t&&this.apply(t)},Studio.extend(Studio.DisplayList,Studio.DisplayObject),Studio.DisplayList.prototype.cacheAsBitmap=function(t){this.cache=document.createElement("canvas"),this.cache.height=this.height*t.resolution,this.cache.width=this.width*t.resolution,this.ctx=this.cache.getContext("2d"),this.ctx.scale(t.resolution,t.resolution)},Studio.DisplayList.prototype.updateCache=function(){this.cached=!1,this.ctx.clearRect(0,0,this.width,this.height),this.render(this,1),this.cached=!0},Studio.DisplayList.prototype._cacheIt=function(){this.ctx.clearRect(0,0,this.width,this.height),this.render(this,1)},Studio.DisplayList.prototype.updateElement=function(t){t.render(this)},Studio.DisplayList.prototype.clearCachedElement=function(t){this.ctx.clearRect(t._x-t.width/2,t._y-t.height/2,t.width,t.height)},Studio.DisplayList.prototype.markedForRemoval=function(t){this.marked[this.marked.length]=t},Studio.DisplayList.prototype.removeMarked=function(){for(var t=0;t!==this.marked.length;t++)this.marked[t]&&this.clearCachedElement(this.marked[t]),this.marked[t]=null;this.marked.lengh=0},Studio.DisplayList.prototype.deactivateCache=function(){this.cached=!1},Studio.DisplayList.prototype.update=function(){this.marked.length&&this.removeMarked(),this.update_visibility(),this.update_scale(),this.update_dimensions(),this.update_xy(),this.update_speed();for(var t=this.first;t;)this.next=t.next,t.update(),t=t.next||this.next;!this.cached&&this.autoCache&&this.ctx&&this.updateCache()},Studio.DisplayList.prototype.render=function(t,i){if(this.cached)this._alpha!==t.ctx.globalAlpha&&(t.ctx.globalAlpha=this._alpha),this.draw(t.ctx);else for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},Studio.DisplayList.prototype.add=function(t){return t.parent=this,this.length++,this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},Studio.DisplayList.prototype.draw=function(t){t.drawImage(this.cache,0,0,this.cache.width,this.cache.height,this._x,this._y,this._width,this._height)},Studio.addTo(Studio.DisplayList.prototype,LinkedList.prototype),Studio.Rect=function(t){this.color=new Studio.Color(1,0,0,0),this.slice=new Studio.Box(10,0,0,0),t&&this.apply(t)},Studio.extend(Studio.Rect,Studio.DisplayObject),Studio.Rect.prototype.addVert=function(t,i,e,s,o,h){t._batch[t._count++]=i,t._batch[t._count++]=e,t._batch[t._count++]=this.color.r,t._batch[t._count++]=this.color.g,t._batch[t._count++]=this.color.b,t._batch[t._count++]=this.color.a,t._batch[t._count++]=o,t._batch[t._count++]=h},Studio.Rect.prototype.buildElement=function(t,i){this._delta(i),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._world.z,this.slice.left,this.slice.top),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.slice.right,this.slice.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.slice.left,this.slice.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._world.z,this.slice.right,this.slice.bottom)},Studio.Rect.prototype.buildTriangles=function(t,i){this._delta(i),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._world.z,this.slice.left,this.slice.top),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.slice.right,this.slice.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.slice.left,this.slice.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._world.z,this.slice.right,this.slice.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._world.z,this.slice.left,this.slice.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._world.z,this.slice.right,this.slice.bottom)},Studio.Rect.prototype.setStyle=function(t){this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Rect.prototype.prepAngled=function(t){(this._dx||this._dy)&&t.translate(this._dx,this._dy),t.rotate(this._dAngle||0),(1!==this._world.scaleX||1!==this._world.scaleY)&&t.scale(this._world.scaleX,this._world.scaleY)},Studio.Rect.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.fillRect(-(this.width*this.anchorX),-(this.height*this.anchorY),this.width,this.height),t.restore()},Studio.Rect.prototype.draw=function(t){this.setStyle(t),this.setAlpha(t),t.strokeStyle="#fff",this.angle?this.drawAngled(t):t.fillRect(this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY,this._world.width,this._world.height)},Studio.difference={},Studio.Rect.prototype.hitTestRect=function(t){return Studio.difference.height=this._world.height+t._world.height,Studio.difference.width=this._world.width+t._world.width,Studio.difference.x=this._world.x-this._world.width*this.anchorX-t._x-t._world.width*t.anchorX,Studio.difference.y=this._world.y-this._world.height*this.anchorY-t._y-t._world.height*t.anchorY,Studio.difference.x<0&&Studio.difference.y<=0&&Studio.difference.height+Studio.difference.y>=0&&Studio.difference.width+Studio.difference.x>=0?!0:!1},Studio.Clip=function(t){t&&this.apply(t)},Studio.extend(Studio.Clip,Studio.Rect),Studio.Clip.prototype.draw=function(t){t.save(),t.beginPath(),this.angle?this.drawAngled(t):t.rect(this._dx-this._width*this.anchorX,this._dy-this._height*this.anchorY,this._width,this._height),t.stroke(),t.clip()},Studio.Clip.prototype.drawAngled=function(t){this.prepAngled(t),t.rect(-(this.width*this.anchorX),-(this.height*this.anchorY),this.width,this.height)},Studio.CircleClip=function(t){t&&this.apply(t)},Studio.extend(Studio.CircleClip,Studio.Rect),Studio.CircleClip.prototype.draw=function(t){t.save(),t.beginPath(),t.arc(this._dx,this._dy,this._world.width/2,0,2*Math.PI),t.clip()},Studio.Restore=function(){},Studio.Restore.prototype=new Studio.Rect,Studio.Restore.prototype.constructor=Studio.Restore,Studio.Restore.prototype.draw=function(t){t.restore()},Studio.Circle=function(t){this.color=new Studio.Color(1,0,0,0),t&&this.apply(t)},Studio.extend(Studio.Circle,Studio.Rect),Studio.Circle.prototype.draw=function(t){this.setStyle(t),this.setAlpha(t),t.beginPath(),t.arc(this._world.x,this._world.y,this._world.width,0,2*Math.PI),t.fill()},Studio.Sprite=function(t){this.image=null,this.color=new Studio.Color(1,1,1,1),this._boundingBox=new Studio.Box,t&&this.apply(t)},Studio.extend(Studio.Sprite,Studio.Rect),Studio.Sprite.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.image.image,0,0,this.image.width,this.image.height,-(this.width*this.anchorX),-(this.height*this.anchorY),this.width,this.height),t.restore()},Studio.Sprite.prototype.draw=function(t){this.image&&this.image.ready&&(this.setAlpha(t),this.angle?this.drawAngled(t):t.drawImage(this.image.image,0,0,this.image.width,this.image.height,this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY,this._world.width,this._world.height))},Studio.ImageSlice=function(t){this.image=null,this.color=new Studio.Color(1,1,1,1),this.rect={x:0,y:0,height:32,width:32},this._boundingBox=new Studio.Box,t&&this.apply(t)},Studio.extend(Studio.ImageSlice,Studio.Sprite),Studio.ImageSlice.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.image.image,this.rect.x,this.rect.y,this.rect.width,this.rect.height,-(this.width*this.anchorX),-(this.height*this.anchorY),this.width,this.height),t.restore()},Studio.ImageSlice.prototype.draw=function(t){this.image&&this.image.ready&&(this.setAlpha(t),this.angle?this.drawAngled(t):t.drawImage(this.image.image,this.rect.x,this.rect.y,this.rect.width,this.rect.height,this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY,this._world.width,this._world.height))},Studio.SpriteAnimation=function(t){this.sheet=new Studio.SpriteSheet,this.loop=[[0,0]],this.fps=12,this.frame=0,this.sliceX=0,this.sliceY=0,this.repeat=!0,this.startTime=0,t&&this.apply(t),this.setStartingFrame(this.frame)},Studio.extend(Studio.SpriteAnimation,Studio.Rect),Studio.SpriteAnimation.prototype.setStartingFrame=function(t){this.frame=t,this.startTime=Studio.time,this.myTime=this.startTime+t*(1e3/this.fps)},Studio.SpriteAnimation.prototype.draw=function(t){this.sheet&&this.sheet.ready&&(this.setAlpha(t),t.drawImage(this.sheet.image,this.sheet.rect.width*this.sliceX,this.sheet.rect.height*this.sliceY,this.sheet.rect.width,this.sheet.rect.height,this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorX,this._world.width,this._world.height),this.loop.length&&this.updateFrame())},Studio.SpriteAnimation.prototype.setSlice=function(){this.sliceX=this.loop[this.frame][0],this.sliceY=this.loop[this.frame][1]},Studio.SpriteAnimation.prototype.updateFrame=function(){this.myTime+=Studio.delta,this.frame=(this.myTime-this.startTime)*this._speed/(1e3/this.fps)|0,this.frame>=this.loop.length&&(this.startTime=this.myTime,this.frame=0,this.onLoopComplete&&this.onLoopComplete.call(this)),this.setSlice()},Studio.SpriteSheet=function(t,i){this.image=new Studio.Image,this.rect={height:32,width:32},t&&this.loadImage(t),i&&this.apply(i)},Studio.extend(Studio.SpriteSheet,Studio.Image),Studio.SpriteSheet.prototype.apply=function(t){for(var i=Object.keys(t),e=i.length,s;e;)s=i[e-1],this[s]=t[s],e--},Studio.Camera=function(t){this.stage={width:t.width,height:t.height},this.tracking=null,this.bound=null,this.active=!0},Studio.extend(Studio.Camera,Studio.DisplayObject),Studio.Camera.prototype.updateRect=function(){this.left=-this.bound._world.x*this.scaleX,this.top=-this.bound._world.y*this.scaleY,this.right=this.left+(this.bound._world.width*this.scaleX-this.stage.width),this.bottom=this.top+(this.bound._world.height*this.scaleY-this.stage.height)},Studio.Camera.prototype.update=function(t,i){this.tracking&&(this.tracking._delta(i),this.x=this.tracking._dx*this.scaleX-this.stage.width/2,this.y=this.tracking._dy*this.scaleY-this.stage.height/2),this.bound&&(this.updateRect(),this.x<this.left?this.x=this.left:this.x>this.right&&(this.x=this.right),this.y<this.top?this.y=this.top:this.y>this.bottom&&(this.y=this.bottom))},Studio.Camera.prototype.render=function(t,i){this.update(t,i),(this.x||this.y||1!==this.scaleX||1!==this.scaleY)&&t.ctx.setTransform(t.resolution*this.scaleX,0,0,t.resolution*this.scaleY,-this.x*t.resolution,-this.y*t.resolution)},Studio.Camera.prototype.track=function(t){this.tracking=t},Studio.Camera.prototype.bindTo=function(t){this.bound=t},Studio.Camera.prototype.unBind=function(){this.bindTo(null)},Studio.Camera.prototype.stopTracking=function(){this.track(null)},Studio.Scene=function(t){this.color=new Studio.Color(0,0,0,0),this.active=!1,this.image=null,this.loader=null,this.assets=[],this.children=[],t&&this.apply(t),this.build&&this.build(),this.init&&this.init()},Studio.extend(Studio.Scene,Studio.DisplayObject),Studio.Scene.prototype.loadAssets=function(){for(var t=0;t!==arguments.length;t++)this.assets.push(new Studio.Image(arguments[t]))},Studio.Scene.prototype.setStyle=function(t){this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Scene.prototype.draw=function(t){return this.setAlpha(t),this.image?void t.drawImage(this.image.image,this._world.x,this._world.y,this.width,this.height):this.color?0===this.color.a?void t.clearRect(this._world.x,this._world.y,this.width,this.height):(this.setStyle(t),void t.fillRect(this._world.x,this._world.y,this.width,this.height)):void 0},Studio.Stage=function(t,i){return this.webgl=!1,this.fullscreen=!1,this.color=new Studio.Color(0,0,0,1),this.snap=!1,i&&this.apply(i),this._getCanvasElement(t),this._count=0,this._maxCount=16050,this.dur=1e3/60,this._d=0,this.resolution=window.devicePixelRatio,i&&this.apply(i),this._sizeCanvas(this.fullscreen),this.setPixelRatio(),this.webgl&&(this.engine=Studio.Stage.prototype.WEBGL),this.allowPlugins(),this.engine.getContext.call(this),this.engine.init.call(this,this.ctx),this.engine.prep.call(this,this.ctx),this.render=this.engine.render,this._init(),console.log("%cStudio3 v"+Studio.version+"%c"+this.engine.type,Studio.infoStyle,Studio.engineStyle),this.verts=0,this},Studio.extend(Studio.Stage,Studio.Scene),Studio.Stage.prototype._getCanvasElement=function(t){if(t)this.canvas=document.getElementById(t);else{var i=document.body.getElementsByTagName("canvas");i[0]?this.canvas=i[0]:(this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas))}},Studio.Stage.prototype.setColor=function(t,i,e,s){this.color.set(t,i,e,s),this.ctx.clearColor&&this.ctx.clearColor(this.color.r,this.color.g,this.color.b,this.color.a)},Studio.Stage.prototype._init=function(){return this.ready=!1,this.autoPause=!1,this._watching=!1,this.children=[],this.buttons=[],this.activeScene=null,this.previousScene=null,this.camera=new Studio.Camera(this),this.tweens=Object.create(null),this.tween_length=0,this.nextID=0,this.anchorX=0,this.anchorY=0,this.active=!0,this._pause_buttons=!1,Studio.stage=this,this},Studio.Stage.prototype.allowPlugins=function(){this.plugins=Object.create(null),this.plugins.input=[],this.plugins.effect=[],this._effects=0},Studio.Stage.prototype._sizeCanvas=function(t){this.height=this.canvas.height,this.width=this.canvas.width,this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this._scaleRatio=1,t&&(this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.style.height="100%",this.canvas.style.width="100%")},Studio.Stage.prototype.pauseButtons=function(t){this._pause_buttons=t},Studio.Stage.prototype.setPixelRatio=function(){this.canvas.width=this.width*this.resolution,this.canvas.height=this.height*this.resolution},Studio.Stage.prototype.fillScreen=function(){},Studio.Stage.prototype.addInput=function(t){this.plugins.input.push(t)},Studio.Stage.prototype.addEffect=function(t,i){i&&t._options(i),t.init(this),this.plugins.effect.push(t),this._effects++},Studio.Stage.prototype.checkDataAttributes=function(){},Studio.Stage.prototype.setScene=function(t){t.parent=this,this.activeScene&&2===Studio.progress&&this.activeScene.onDeactivate&&this.activeScene.onDeactivate(),this.previousScene=this.activeScene,this.activeScene=t,this.activeScene.active=!0,t.onActivate&&t.onActivate()},Studio.Stage.prototype.watch=function(t){this._watching=t,this.children=t.children,this.hasChildren=t.hasChildren},Studio.Stage.prototype.addButton=function(t){this.buttons.unshift(t)},Studio.Stage.prototype.update_children=function(t,i){for(this.i=0;this.i!==this.hasChildren;this.i++)this.children[this.i].active&&this.children[this.i].update(t,i)},Studio.Stage.prototype.render_children=function(t){for(this.i=0;this.i!==this.hasChildren;this.i++)this.children[this.i].active&&this.children[this.i].render(this,t)},Studio.Stage.prototype.update_visibility=function(){this._alpha=this.alpha},Studio.Stage.prototype._timebased_updates=function(t){this.update_tweens(t)},Studio.Stage.prototype.update=function(t,i){this.onEnterFrame&&this.onEnterFrame(),this._width=this.width,this._height=this.height,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._speed=this.camera.speed,this.update_visibility(),2===Studio.progress&&(this.activeScene&&this.activeScene.update(t,i),this.previousScene&&this.previousScene.active&&this.previousScene.update(t,i),(this.hasChildren||this._watching)&&this.update_children(),this.beforeDraw&&this.beforeDraw())},Studio.Stage.prototype.runEffects=function(){for(this.i=0;this.i!==this._effects;this.i++)this.plugins.effect[this.i].action(this)},Studio.Stage.prototype.loading=function(t){Studio.loaded===!0&&(this.onReady&&this.onReady(t),
this.loop=this.activeloop)},Studio.Stage.prototype.activeloop=function(t){if(2===Studio.progress)return this.timeStep(t),void(this._effects&&this.runEffects(t));if(1===Studio.progress){if(this.onReady&&this.onReady(t),Studio.progress=2,!this.activeScene)return;this.activeScene.onActivate&&this.activeScene.onActivate()}},Studio.Stage.prototype.loop=Studio.Stage.prototype.loading,Studio.Stage.prototype.drawProgress=function(t){this.progressBar(t,Studio.progress),t.restore()},Studio.Stage.prototype.progressBar=function(t,i){t.fillStyle="rgba(255,255,255,.8)",t.fillRect((this.width-202)/2,(this.height-22)/2,202,22),t.fillStyle="rgba(0,0,0,1)",t.fillRect(2+(this.width-202)/2,2+(this.height-22)/2,198*i,18)},Studio.TextBox=function(t,i,e){return this.font="12px Arial",this.lineHeight=10,this.height=i,this.width=t,this.shadow=1,this.shadowColor="rgba(0,0,0,0.5)",this.cache=new Studio.Cache(t,i,e.resolution),this.cache.buffer.textBaseline="top",this.cache.buffer.font=this.font,this.text="",this.color="#fff",this._wrap_height=this.lineHeight,this.horizontal_align=Studio.LEFT,this.vertical_align=Studio.TOP,this._vertical_align=0,this},Studio.extend(Studio.TextBox,Studio.Rect),Studio.TextBox.prototype.setFont=function(t){return this.font=t,this},Studio.TextBox.prototype.setText=function(t){return this.text=t,this},Studio.TextBox.prototype.setColor=function(t){return this.color=t,this},Studio.TextBox.prototype.setFont=function(t){return this.cache.buffer.font=this.font=t,this},Studio.TextBox.prototype.finish=function(){this.reset(),this.wrapText()},Studio.TextBox.prototype.reset=function(){this.cache.buffer.clearRect(0,0,this.width,this.height),this.cache.buffer.font=this.font},Studio.TextBox.prototype.writeLine=function(t,i,e){this.shadow&&(this.cache.buffer.fillStyle=this.shadowColor,this.cache.buffer.fillText(t,i+1+this.shadow,e+this.shadow)),this.cache.buffer.fillStyle=this.color,this.cache.buffer.fillText(t,i+1,e)},Studio.TextBox.prototype.wrapText=function(){for(var t=this.text.split("\n"),i=0,e=0;e!==t.length;e++){for(var s=t[e].split(" "),o="",h=0;h<s.length;h++){var n=o+s[h]+" ",r=this.cache.buffer.measureText(n),a=r.width;a>this.width&&h>0?(a=this.cache.buffer.measureText(o).width,this.writeLine(o,2+(this.width-a)*this.horizontal_align|0,i),o=s[h]+" ",i+=this.lineHeight):o=n}this.writeLine(o,2+(this.width-this.cache.buffer.measureText(o).width)*this.horizontal_align|0,i),this._wrap_height=i+this.lineHeight,e!==t.length-1&&(i+=this.lineHeight)}this._wrap_height>this.height&&(this._wrap_height=this.height),this._vertical_align=this._wrap_height*this.vertical_align-this.height*this.vertical_align|0},Studio.TextBox.prototype.fit=function(){this.cache.height=this._wrap_height,this.wrapText()},Studio.TextBox.prototype.debugDraw=function(t){t.strokeRect(this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY-this._vertical_align,this._world.width,this._wrap_height)},Studio.TextBox.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.drawImage(this.cache.image,0,0,this.cache.image.width,this.cache.image.height,-(this.width*this.anchorX),-(this.height*this.anchorY)-this._vertical_align,this.width,this.height),t.restore()},Studio.TextBox.prototype.draw=function(t){this.setAlpha(t),this.angle?this.drawAngled(t):t.drawImage(this.cache.image,0,0,this.cache.image.width,this.cache.image.height,this._dx-this._world.width*this.anchorX,this._dy-this._world.height*this.anchorY-this._vertical_align,this._world.width,this._world.height)},Studio.Stage.prototype.update_tweens=function(t){var i,e=0,s,o,h;for(i in this.tweens)if(s=this.tweens[i],s.actor._world?s.cur+=t*s.actor._world.speed:s.cur+=t,!s.active&&s.onStart&&(s.onStart.call(s.actor),s.active=1),h=s.dir?1-s.cur/s.duration:s.cur/s.duration,1>h&&h>0)for(e=0;e!==s.keys.length;e++)o=s.keys[e],this.update_property(s,o,h);else if(s.next)s.next._snapshot(),s.next.cur=s.cur-s.duration,this.tweens[i]=s.next;else{if(s._loop)return s.cur=0,s.onEnd&&s.onEnd.call(s.actor),void(s._reflect?s.dir?s.dir=0:s.dir=1:(s.actor.apply(s.original),s.active=0));s.reset?s.actor.apply(s.original):s.actor.apply(s.to),s.onEnd&&s.onEnd.call(s.actor),s=null,this.tweens[i]=null,delete this.tweens[i]}},Studio.Stage.prototype.update_property=function(t,i,e){t.actor[i]=t.original[i]+Studio.Ease[t.ease](e)*(t.to[i]-t.original[i])},Studio._tween_object=function(t,i,e,s,o,h){this.actor=t,this.ease=i,this.original={},this.to=e,this.cur=0,this.duration=s,this.onStart=h,this.onEnd=o,this._loop=!1,this._reflect=!0,this.reset=!1,this.dir=0,this.active=0,this.id=null,this.keys=Object.keys(e),this.next=null,this.prev=null},Studio._tween_object.prototype.constructor=Studio._tween_object,Studio._tween_object.prototype.loop=function(){return this._loop=!0,this},Studio._tween_object.prototype.apply=function(t){for(var i in t)this[i]=t[i];return this},Studio._tween_object.prototype.reflect=function(t){return this._reflect=t,this},Studio._tween_object.prototype.setActor=function(t){return this.actor=t,this},Studio.Stage.prototype.createTween=function(t,i,e,s,o,h){var n=new Studio._tween_object(t,i,e,s,o,h);n.id=this.nextID;for(var r in e)n.original[r]=t[r];return this.nextID++,n},Studio._tween_object.prototype._snapshot=function(){for(var t in this.to)this.original[t]=this.actor[t]},Studio._tween_object.prototype.then=function(t,i,e,s,o){return this.next=new Studio._tween_object(this.actor,t,i,e,s,o),this.next.prev=this,this.next},Studio._tween_object.prototype.last=function(){for(var t=this.next,i=this;null!==t;)i=t,t=t.next;return i},Studio._tween_object.prototype.completeLoop=function(t){return this.next=t,t.prev=this,this.next},Studio.Stage.prototype.createLoop=function(t,i,e,s,o){return this.tweens[this.nextID]=this.createTween(t,i,e,s,o),this.tweens[this.nextID-1].loop=!0,this.tweens[this.nextID-1]},Studio.Stage.prototype.addTween=function(t,i,e,s,o){return this.tweens[this.nextID]=this.createTween(t,i,e,s,o),this.tweens[this.nextID-1]},Studio.Stage.prototype.playTween=function(t){t.cur=0;for(var i=0;i!==t.keys.length;i++)t.original[t.keys[i]]=t.actor[t.keys[i]];this.tweens[t.id]=t},Studio.Stage.prototype.stopTween=function(t,i,e){if(this.tweens[t.id]){if(t.cur=0,t.dir=0,i){var s;if(e)for(s=0;s!==t.keys.length;s++)t.actor[t.keys[s]]=t.original[t.keys[s]];else for(s=0;s!==t.keys.length;s++)t.actor[t.keys[s]]=t.to[t.keys[s]]}this.tweens[t.id]=null,delete this.tweens[t.id]}},Studio.Effect={},Studio.Effect.BillAtkinsonDither_BW=new Studio.Plugin({options:{},init:function(t){this.oldpixel=1,this.newpixel=1,this.qerror=1},action:function(t){for(var i=t.ctx.getImageData(0,0,t.canvas.width,t.canvas.height),e=i.data,s=parseInt(4*t.canvas.width),o=e.length,h=0;o>h;h+=4)this.oldpixel=e[h],this.newpixel=this.oldpixel>>7,this.newpixel*=255,e[h]=e[h+1]=e[h+2]=this.newpixel,this.qerror=.15*(this.oldpixel-this.newpixel),h%s===0&&h+4%s===0&&h+8%s===0||(e[h+5]=e[h+6]=e[h+4]+=this.qerror,e[h+9]=e[h+10]=e[h+8]+=this.qerror,e[h+5+s]=e[h+6+s]=e[h+4+s]+=this.qerror,e[h+1+s]=e[h+2+s]=e[h+s]+=this.qerror,e[h+s-3]=e[h+s-2]=e[h+s-4]+=this.qerror,e[h+2*s]=e[h+2*s]=e[h+2*s]+=this.qerror);t.ctx.putImageData(i,0,0)}}),Studio.Effect.Posterize=new Studio.Plugin({options:{},init:function(t){this.oldpixel=1,this.newpixel=1,this.qerror=1},action:function(t){for(var i=t.ctx.getImageData(0,0,t.canvas.width,t.canvas.height),e=i.data,s=4*t.canvas.width,o=e.length,h=0;o>h;h++)this.oldpixel=e[h],this.newpixel=this.oldpixel>>7,this.newpixel*=255,e[h]=this.newpixel;t.ctx.putImageData(i,0,0)}}),Studio.Effect.Replicator=new Studio.Plugin({options:{x:3,y:3},init:function(t){this.cache=new Studio.Cache},action:function(t){var i=t.canvas.width/this.options.x,e=t.canvas.height/this.options.y;this.cache.image.width=i,this.cache.image.height=e,this.cache.buffer.drawImage(t.canvas,0,0,i,e);for(var s=0;s!=this.options.x;s++)for(var o=0;o!=this.options.y;o++)t.ctx.drawImage(this.cache.image,s*i,o*e,i,e)}}),Studio.Effect.Bloom=new Studio.Plugin({options:{},init:function(t){this.height=t.canvas.height/2*t.resolution,this.width=t.canvas.width/2*t.resolution,this.cache=new Studio.Cache(this.width,this.height),this.cache.buffer.globalAlpha=.25},action:function(t){this.cache.buffer.globalCompositeOperation="source-over",this.cache.buffer.fillStyle="rgba(0,0,0,.35)",this.cache.buffer.fillRect(0,0,this.width,this.height),this.cache.buffer.globalCompositeOperation="lighten",this.cache.buffer.drawImage(t.canvas,0,0,t.width,t.height),t.ctx.globalCompositeOperation="lighten",t.ctx.drawImage(this.cache.image,0,0,t.canvas.width,t.canvas.height),t.ctx.globalCompositeOperation="source-over"}}),Studio.Effect.Cursor=new Studio.Plugin({options:{},init:function(t){this.cursor=new Studio.Image("assets/cursor.png"),t.canvas.style.cursor="none"},action:function(t){t.ctx.drawImage(this.cursor.image,t.mouse.x-8,t.mouse.y-8,48,48)}}),Studio.Effect.Red=new Studio.Plugin({options:{},init:function(t){},action:function(t){for(var i=t.ctx.getImageData(0,0,t.canvas.width,t.canvas.height),e=i.data.buffer,s=new Uint8Array(e),o=new Uint32Array(e),h=o.length,n=0;n!=h;n++){var r=i.data[4*n+1];o[n]=255<<24|255-r<<16|r<<8|255-r}i.data.set(s),t.ctx.putImageData(i,0,0)}}),Studio.Effect.Wave=new Studio.Plugin({action:function(t){this.cache.buffer.drawImage(t.canvas,0,0,t.width,t.height);for(var i=this.w.length,e=0;e!=i;e+=1)t.ctx.drawImage(this.cache.image,e*this.width,0,this.width,t.height,e*this.width,this.w[e],this.width,t.height),this.w[e]+=2*Math.cos(this.count),this.count+=.02},init:function(t){this.width=1,this.w=[];for(var i=Math.ceil(t.width/this.width),e=0;i>e;e+=1)this.w[e]=0;this.cache=new Studio.Cache(t.width,t.height),this.count=0}});var FRAGMENTSHADER=["precision lowp float;","uniform sampler2D u_image;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","   if(v_texture.x==10.0){","		gl_FragColor = v_color;","	}else{","		gl_FragColor = texture2D(u_image, v_texture) * v_color;","	}","}"].join("\n"),VERTEXSHADER=["attribute vec3 a_position;","attribute vec4 a_color;","attribute vec2 a_texture;","uniform vec2 u_resolution;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","	vec2 canvas_coords = ((vec2(a_position.x,a_position.y)/ u_resolution)*2.0) - 1.0;","	gl_Position = vec4(canvas_coords * vec2(1.0,-1.0), a_position.z, 1.0);","	v_color = a_color;","	v_texture = a_texture;","}"].join("\n");Studio.Stage.prototype.loadShader=function(t,i){this.ctx.shaderSource(t,i)},Studio.Stage.prototype.WEBGL={type:"webgl",antialias:!1,premultipliedAlpha:!1,stencil:!0,getContext:function(){this.ctx=this.canvas.getContext("webgl",{antialias:this.WEBGL.antialias,premultipliedAlpha:this.WEBGL.premultipliedAlpha,stencil:this.WEBGL.stencil})},init:function(t){t._count=0,t._batch=new Float32Array(523360),t.clearColor(this.color.r,this.color.g,this.color.b,this.color.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.vertexShader=t.createShader(t.VERTEX_SHADER),this.loadShader(this.vertexShader,VERTEXSHADER),t.compileShader(this.vertexShader),this.fragmentShader=t.createShader(t.FRAGMENT_SHADER),this.loadShader(this.fragmentShader,FRAGMENTSHADER),t.compileShader(this.fragmentShader),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.linkProgram(this.program),t.useProgram(this.program),this.buffer=t.createBuffer()},prep:function(t){t.resolutionLocation=t.getUniformLocation(this.program,"u_resolution"),t.enableVertexAttribArray(0),t.positionLocation=t.getAttribLocation(this.program,"a_position"),t.bindAttribLocation(this.program,0,"a_position"),t.colorLocation=t.getAttribLocation(this.program,"a_color"),t.textureLocation=t.getAttribLocation(this.program,"a_texture"),t.uniform2f(t.resolutionLocation,this.width,this.height),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.enableVertexAttribArray(t.positionLocation),t.enableVertexAttribArray(t.colorLocation),t.enableVertexAttribArray(t.textureLocation),t.vertexAttribPointer(t.positionLocation,2,t.FLOAT,!1,32,0),t.vertexAttribPointer(t.colorLocation,4,t.FLOAT,!1,32,8),t.vertexAttribPointer(t.textureLocation,2,t.FLOAT,!1,32,24),this._rect_index_buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),this._rect_index=new Uint16Array(6*this._maxCount);for(var i=0,e=0;i<6*this._maxCount;i+=6,e+=4)this._rect_index[i+0]=e+0,this._rect_index[i+1]=e+1,this._rect_index[i+2]=e+2,this._rect_index[i+3]=e+1,this._rect_index[i+4]=e+2,this._rect_index[i+5]=e+3;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._rect_index,t.STATIC_DRAW),this._r_count=0},render:function(t){this.ctx._count=0,this.vertex_children(this.ctx,t),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,this.ctx._batch,this.ctx.DYNAMIC_DRAW),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT),this.ctx.drawElements(this.ctx.TRIANGLES,6*this.hasChildren,this.ctx.UNSIGNED_SHORT,0)}},Studio.Stage.prototype.CANVAS={type:"2dContext",getContext:function(){this.ctx=this.canvas.getContext("2d")},init:function(){},prep:function(){},render:function(t){this.ctx.setTransform(this.resolution,0,0,this.resolution,0,0),this.draw(this.ctx),this.camera.render(this,t),this.activeScene&&(this.activeScene.beforeDraw&&this.activeScene.beforeDraw(),this.activeScene.render(this,t)),this.previousScene&&this.previousScene.active&&this.previousScene.render(this,t),this.hasChildren&&this.render_children(t)}},Studio.fixedTimeStep=function(t){this.step(t),this.render(this._lag),this._timebased_updates(t),this.fixedStep()},Studio.simple=function(){this.render(1),this.update()},Studio.Stage.prototype.timeStep=Studio.fixedTimeStep,Studio.Stage.prototype.fixedStep=function(){for(;this._d>=this.dur;)this._d-=this.dur,this.update()},Studio.Stage.prototype.step=function(t){this._d+=t,this._lag=this._d/this.dur,this._lag>1&&(this._lag=1)},Studio.Stage.prototype.engine=Studio.Stage.prototype.CANVAS,Studio.Stage.prototype.enableKeyboardInput=function(){var t=this;this.keys={};var i=function(i){i.preventDefault(),t.keys[i.keyCode]=1},e=function(i){i.preventDefault(),t.keys[i.keyCode]=0};document.addEventListener("keydown",i,!1),document.addEventListener("keyup",e,!1)},Studio.Stage.prototype.enableTouchEvents=function(){var t=this,i={x:0,y:0,dx:0,dy:0,id:0};this.mouse=i,this.mouse_onDown=function(t){if(this.buttons&&!this._pause_buttons)for(var i=0;i!==this.buttons.length;i++)if(this.buttons[i]._touchID||!this.buttons[i]._visible);else if(this.buttons[i].hitTestPoint(t.x,t.y)){if(this.buttons[i]._touchID=t.id,this.buttons[i].onTap&&this.buttons[i].onTap(t),this.buttons[i].preventBubble)return}else this.buttons[i].onTapOutside&&this.buttons[i].onTapOutside(t)},this.mouse_onMove=function(t){if(this.buttons&&!this._pause_buttons)for(var i=0;i!==this.buttons.length;i++)this.buttons[i].hitTestPoint(t.x,t.y)?(this.buttons[i].draggable&&t.id&&this.buttons[i]._touchID===t.id&&(this.buttons[i]._activeDrag?this.buttons[i].onDrag&&this.buttons[i].onDrag(t):(this.buttons[i].onDragStart&&this.buttons[i].onDragStart(t),this.buttons[i]._activeDrag=!0)),this.buttons[i].onHoverStart&&!this.buttons[i].hovering?this.buttons[i].onHoverStart(t):this.buttons[i].onHover&&this.buttons[i].onHover(t),this.buttons[i].hovering=!0):this.buttons[i].hovering&&(this.buttons[i].hovering=!1,this.buttons[i].onHoverEnd&&this.buttons[i].onHoverEnd()),this.buttons[i].draggable&&this.buttons[i]._activeDrag&&this.buttons[i]._touchID===t.id&&(this.relativeX=t.dx,this.relativeY=t.dy,this.buttons[i].angle&&(this.buttons[i].orbits||this.buttons[i].inheritRotation)&&(this.relativeX=t.dx*Math.cos(-this.buttons[i].angle)-t.dy*Math.sin(-this.buttons[i].angle),this.relativeY=t.dx*Math.sin(-this.buttons[i].angle)+t.dy*Math.cos(-this.buttons[i].angle),t.dx=this.relativeX,t.dy=this.relativeY),this.buttons[i].onDrag&&this.buttons[i].onDrag(t)),this.buttons[i].onTouchMove&&this.buttons[i].onTouchMove(t)},this.mouse_onUp=function(t){if(this.buttons)for(var i=0;i!==this.buttons.length;i++)this.buttons[i]._touchID===t.id&&(this.buttons[i]._activeDrag&&this.buttons[i].onDragEnd&&this.buttons[i].onDragEnd(t),this.buttons[i].hitTestPoint(t.x,t.y)?this.buttons[i].onRelease&&this.buttons[i].onRelease(t):this.buttons[i].onReleaseOutside&&this.buttons[i].onReleaseOutside(t),this.buttons[i]._activeDrag=!1,this.buttons[i]._touchID=0)};var e={clientX:0,clientY:0},s=function(i){e.clientX=(i.clientX-t.canvas.offsetLeft)/t._scaleRatio,e.clientY=(i.clientY-t.canvas.offsetTop)/t._scaleRatio},o=function(o){s(o),i.id=1,i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,i.dx=i.dy=0,t.mouse_onDown(i)},h=function(o){s(o),i.dx=i.x-(e.clientX+t.camera.x),i.dy=i.y-(e.clientY+t.camera.y),i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,t.mouse_onMove(i)},n=function(){t.mouse_onUp(i),i.id=0};this._mouseWindow?(document.addEventListener("mousedown",o,!1),document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",n,!1),document.addEventListener("mouseout",n,!1)):(this.canvas.addEventListener("mousedown",o,!1),this.canvas.addEventListener("mousemove",h,!1),this.canvas.addEventListener("mouseup",n,!1),this.canvas.addEventListener("mouseout",n,!1));var r={},a=0,d=0,u=function(i){i.preventDefault(),d=i.targetTouches.length;for(var o=0;o!==d;o++)a=i.targetTouches[o].identifier,s(i.targetTouches[o]),r[a]={},r[a].id=a,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,r[a].dx=0,r[a].dy=0,t.mouse_onDown(r[a])},c=function(i){i.preventDefault(),d=i.targetTouches.length;for(var o=0;o!==d;o++)a=i.targetTouches[o].identifier,s(i.targetTouches[o]),r[a].dx=r[a].x-e.clientX,r[a].dy=r[a].y-e.clientY,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,t.mouse_onMove(r[a])},l=function(i){i.preventDefault(),d=i.changedTouches.length;for(var e=0;e!==d;e++)a=i.changedTouches[e].identifier,t.mouse_onUp(r[a]),delete r[a]};window.ejecta?(document.addEventListener("touchstart",u,!1),document.addEventListener("touchmove",c,!1),document.addEventListener("touchend",l,!1),document.addEventListener("touchcancel",l,!1)):(this.canvas.addEventListener("touchstart",u,!1),this.canvas.addEventListener("touchmove",c,!1),this.canvas.addEventListener("touchend",l,!1),this.canvas.addEventListener("touchcancel",l,!1),this.canvas.setAttribute("tabindex","0"),this.canvas.focus())};
//# sourceMappingURL=./studio-compiled.js.map