Studio.Stage.prototype.WEBGL={type:"webgl",antialias:!1,premultipliedAlpha:!1,stencil:!0,getContext:function(){this.ctx=this.canvas.getContext("webgl",{antialias:this.WEBGL.antialias,premultipliedAlpha:this.WEBGL.premultipliedAlpha,stencil:this.WEBGL.stencil})},init:function(t){t._count=0,t._batch=new Float32Array(523360),t.clearColor(this.color.r,this.color.g,this.color.b,this.color.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.vertexShader=t.createShader(t.VERTEX_SHADER),this.loadShader(this.vertexShader,"shader-vs"),t.compileShader(this.vertexShader),this.fragmentShader=t.createShader(t.FRAGMENT_SHADER),this.loadShader(this.fragmentShader,"shader-fs"),t.compileShader(this.fragmentShader),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.linkProgram(this.program),t.useProgram(this.program),this.buffer=t.createBuffer()},prep:function(t){t.resolutionLocation=t.getUniformLocation(this.program,"u_resolution"),t.enableVertexAttribArray(0),t.positionLocation=t.getAttribLocation(this.program,"a_position"),t.colorLocation=t.getAttribLocation(this.program,"a_color"),t.textureLocation=t.getAttribLocation(this.program,"a_texture"),t.uniform2f(t.resolutionLocation,this.width,this.height),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.enableVertexAttribArray(t.positionLocation),t.enableVertexAttribArray(t.colorLocation),t.enableVertexAttribArray(t.textureLocation),t.vertexAttribPointer(t.positionLocation,2,t.FLOAT,!1,32,0),t.vertexAttribPointer(t.colorLocation,4,t.FLOAT,!1,32,8),t.vertexAttribPointer(t.textureLocation,2,t.FLOAT,!1,32,24),this._rect_index_buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),this._rect_index=new Uint16Array(6*this._maxCount);for(var e=0,r=0;e<6*this._maxCount;e+=6,r+=4)this._rect_index[e+0]=r+0,this._rect_index[e+1]=r+1,this._rect_index[e+2]=r+2,this._rect_index[e+3]=r+1,this._rect_index[e+4]=r+2,this._rect_index[e+5]=r+3;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._rect_index,t.STATIC_DRAW),this._r_count=0},loop:function(t,e){this.renderGL(this.ctx),this.updateGL(t,e)}},Studio.Stage.prototype.updateGL=function(t,e){this.onEnterFrame&&this.onEnterFrame(t,e),this.update_children(t,e)},Studio.Stage.prototype.renderGL=function(t){t._count=0,this.hasChildren&&this.vertex_children(t),t.bufferData(t.ARRAY_BUFFER,t._batch,t.DYNAMIC_DRAW),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.drawElements(t.TRIANGLES,6*this._maxCount,t.UNSIGNED_SHORT,0)};