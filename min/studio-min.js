"use strict";function setupPool(t){if(!(t>=0))throw"setupPool takes a size >= 0 as argument.";for(this.pool=this.pool||[],this.poolSize=this.poolSize||0,this.pnew=pnew,Object.defineProperty?Object.defineProperty(this.prototype,"pdispose",{value:pdispose}):Object.prototype.pdispose=pdispose;this.poolSize<t;)(new this).pdispose();this.poolSize>t&&(this.poolSize=t,this.pool.length=t)}function pnew(){var t=null;return 0!==this.poolSize?(this.poolSize--,t=this.pool[this.poolSize],this.pool[this.poolSize]=null):t=new this,this.apply(t,arguments),t}function pdispose(){var t=this.constructor;this.dispose&&this.dispose(),t.pool[t.poolSize++]=this}Object.keys||(console.warn("This browser does not support Object.keys() . Using polyfill instead."),Object.keys=function(){var t=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),e=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],s=e.length;return function(o){if("object"!=typeof o&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var h=[],n,r;for(n in o)t.call(o,n)&&h.push(n);if(i)for(r=0;s>r;r++)t.call(o,e[r])&&h.push(e[r]);return h}}()),"function"!=typeof Object.create&&(console.warn("This browser does not support Object.create() . Using polyfill instead."),Object.create=function(){var t=function(){};return function(i){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof i)throw TypeError("Argument must be an object");t.prototype=i;var e=new t;return t.prototype=null,e}}()),function(){for(var t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i)window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(console.warn("This browser does not support requestAnimationFrame() . Using setTimeout() instead."),window.requestAnimationFrame=function(t){var i=window.setTimeout(function(){t(Date.now())},1e3/30);return i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),Object.defineProperty?Object.defineProperty(Function.prototype,"setupPool",{value:setupPool}):Function.prototype.setupPool=setupPool,window.Studio||(window.Studio=window.ÃŸ={stages:[],stage:null,tko:null,assets:{length:0},queue:0,progress:1,sin:Math.sin,cos:Math.cos,random:Math.random,abs:Math.abs,my:{ratio:1},temp:{},info:{displayObjects:0},active:!0,cap:34,draws:0,loaded:!0,version:"0.5.1",now:0,delta:0},Studio.time=1,Studio.interval=null,Studio.browser=navigator.userAgent.toLowerCase(),Studio.disableRAF=!1),Studio.start=function(t){t?(Studio.time=t,requestAnimationFrame(Studio.loop)):requestAnimationFrame(Studio.start)},Studio.loop=function(t){requestAnimationFrame(Studio.loop),Studio.tick(t),Studio.draws=0,Studio.stage.loop(Studio.delta)},Studio.capped=function(t){this.delta=t-this.now,this.now=t,this.delta=this.cap>this.delta?this.delta:this.cap},Studio.uncapped=function(t){this.delta=t-this.now,this.now=t},Studio.tick=Studio.capped,Studio.stopTime=function(){},Studio.resetTime=function(){},Studio.z_index=function(t,i){return t.z<i.z?-1:t.z>i.z?1:0},Studio.round=function(t){return t+.5|0},Studio.apply=function(t){for(Studio.temp.keys=Object.keys(t),Studio.temp.keys_i=Studio.temp.keys.length;Studio.temp.keys_i;)Studio.temp.key=Studio.temp.keys[Studio.temp.keys_i-1],this[Studio.temp.key]=t[Studio.temp.key],Studio.temp.keys_i--;return this},Studio.addTo=function(t,i){for(var e in i)i.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=i[e])},Studio.infoStyle="background-color: #3af; padding: 2px 4px; color: #fff",Studio.errorStyle="background-color: #c01; padding: 2px 4px;",Studio.warningStyle="background-color: #fd2; padding: 2px 4px;",Studio.engineStyle="background-color: #eee; color: #3af; padding: 1px 4px; border: 1px solid #3af",Studio.Box=function(t,i,e,s){return this.left=t||0,this.top=i||0,this.right=t+e||1,this.bottom=i+s||1,this},Studio.Box.prototype={constructor:Studio.Box,set:function(t,i,e,s){this.left=t||this.left,this.top=i||this.top,this.right=t+e||this.right,this.bottom=i+s||this.bottom},get_bounds:function(t){this.get_straight_bounds(t)},get_straight_bounds:function(t){this.left=t._dx-t._width*t.anchorX,this.right=this.left+t._width,this.top=t._dy-t._height*t.anchorY,this.bottom=this.top+t._height},get_rotated_bounds:function(t){this.left=t._x-t._width*t.anchorX*2,this.right=this.left+3*t._width,this.top=t._y-t._height*t.anchorY*3,this.bottom=this.top+2*t._height}},Studio.Color=function(t,i,e,s){return this.r=t/255||0,this.g=i/255||0,this.b=e/255||0,this.a=s||1,this.style="rgba(255,255,255,1)",this.build_style(),this},Studio.Color.prototype={constructor:Studio.Color,set:function(t,i,e,s){this.r=t/255,this.g=i/255,this.b=e/255,this.a=s,this.build_style()},build_style:function(){this.style="rgba("+parseInt(255*this.r)+","+parseInt(255*this.g)+","+parseInt(255*this.b)+","+this.a+")"},hex:function(t){}},Studio.RED=new Studio.Color(204,0,17,1),Studio.YELLOW=new Studio.Color(255,221,34,1),Studio.BLUE=new Studio.Color(51,170,255,1),Studio.DisplayObject=function(t){this.x=0,this.y=0,this.z=0,this.height=1,this.width=1,this.scaleX=1,this.scaleY=1,this.anchorX=.5,this.anchorY=.5,this.rotation=0,this.alpha=1,this.visible=1,this.speed=1,this.active=1,this.orbits=!0,this.inheritRotation=!0,this.orbit_speed=1,t&&this.apply(t),this._x=this.x,this._y=this.y,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._width=this.width*this._scaleX,this._height=this.height*this._scaleY,this._anchoredX=this.anchorX*this._width,this._anchoredY=this.anchorY*this._height,this._boundingBox=new Studio.Box,this._rotation=this.rotation,this._speed=this.speed,this._alpha=this.alpha,this._visible=this.alpha*this.visible,this.parent=null,this.hasChildren=0,this.__update_XY=!0,this.__update_SCALE=!0,this.__update_DIMENSIONS=!0,this.__update_SPEED=!0,this.__update_ALPHA=!0,this.__update_ROTATION=!0},Studio.DisplayObject.prototype={constructor:Studio.DisplayObject,apply:Studio.apply,addChild:function(t){return this.hasOwnProperty("children")||(this.children=[]),t.parent=this,this.children[this.hasChildren]=t,this.hasChildren++,this},addChildren:function(){for(var t=0;t!==arguments.length;t++)this.addChild(arguments[t]);return this},getChildByName:function(t){for(var i=0;i!==this.hasChildren;i++)if(this.children[i].name===t)return this.children[i];return null},_destroy:function(){for(var t in this)this.hasOwnProperty(t)||delete this[t]},_order:function(){this.children.sort(Studio.z_index)},draw:function(t){},snapPixels:function(){this._x=this._x+.5|0,this._y=this._y+.5|0,this._height=this._height+.5|0,this._width=this._width+.5|0},hitTestPoint:function(t,i){return this._relativeX=t-this._x,this._relativeY=i-this._y,this.anchoredX=this.anchorX*this._width,this.anchoredY=this.anchorY*this._height,this._relativeX<-this.anchoredX&&this._relativeY<-this.anchoredY?!1:this._relativeX>this.width&&this._relativeY>this.height?!1:(this._rotation&&(t=this._relativeX*Math.cos(-this.angle)-this._relativeY*Math.sin(-this.angle),i=this._relativeX*Math.sin(-this.angle)+this._relativeY*Math.cos(-this.angle),this._relativeX=t,this._relativeY=i),this._relativeX>-this.anchoredX&&this._relativeY>-this.anchoredY&&this._relativeX<this._width-this.anchoredX&&this._relativeY<this._height-this.anchoredY?!0:!1)},vertex_children:function(t,i){if(this.hasChildren)for(var e=0;e!==this.hasChildren;e++)this.children[e].buildElement(t,i)},render_children:function(t,i){if(this.hasChildren)for(var e=0;e!==this.hasChildren;e++)this.children[e].render(t,i)},render:function(t,i){this._visible&&(t.snapPixels&&this.snapPixels(),this._delta(i),this.draw(t.ctx),this.render_children(t,i)),this.onExitFrame&&this.onExitFrame()},update_children:function(t,i){if(this.hasChildren)for(var e=0;e!==this.hasChildren;e++)this.children[e].update(t,i)},update_visibility:function(){this._alpha=this.alpha*this.parent._alpha,this._visible=this._alpha*this.visible},setAlpha:function(t){this._alpha!==t.globalAlpha&&this._visible&&(t.globalAlpha=this._alpha)},snapshot:function(){this._x=this.x,this._y=this.y},_delta:function(t){this._dx=this._x+(this.x-this._x)*t,this._dy=this._y+(this.y-this._y)*t},update:function(){this.snapshot(),this.onEnterFrame&&this.onEnterFrame(),this.__update_ALPHA&&this.update_visibility(),this._visible&&this.update_children()}};var LinkedList=function(){this.first=null,this.last=null,this.length=0};LinkedList.prototype={add:function(t){return t.parent=this.parent,this.length++,this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},insert:function(t,i){this.length++,t.prev=i,i!=this.last?i.next=t:(this.last=t,t.next=this.first)},init:function(){this.next=null,this.prev=null,this.first=null,this.last=null,this.length=0},remove:function(t){return 1===this.length?(this.init(),t.next=null,void(t.prev=null)):(this.first===t?this.first=this.first.next:this.last===t&&(this.last=this.last.prev),t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),t.next=null,t.prev=null,null===this.first&&(this.last=null),void this.length--)},update:function(t,i){for(var e=this.first;e;)this.next=e.next,e.update(t,i),e=e.next||this.next},render:function(t,i){for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},action:function(t){for(var i=this.first;i;)this.next=i.next,i[t](),i=i.next||this.next},removeAll:function(t){for(var i=this.first;i;)this.next=i.next,this.pdispose&&this.pdispose(),this.remove(i),i=i.next||this.next;i=null,t&&this.add(t)},print_f:function(){for(var t=this.first,i="linked list : [";t;)i+=t,t=t.next;i+="];"}},LinkedList.prototype.constructor=LinkedList,Studio.DisplayList=function(t){this.cache=null,this.ctx=null,this.cached=!1,this.first=null,this.last=null,this.length=0,this.marked=[],this.autoCache=!0,t&&this.apply(t)},Studio.DisplayList.prototype=new Studio.DisplayObject,Studio.DisplayList.prototype.constructor=Studio.DisplayList,Studio.DisplayList.prototype.cacheAsBitmap=function(t){this.cache=document.createElement("canvas"),this.cache.height=this.height*t.resolution||400,this.cache.width=this.width*t.resolution||320,this.ctx=this.cache.getContext("2d"),this.ctx.scale(t.resolution,t.resolution)},Studio.DisplayList.prototype.updateCache=function(){this.cached=!1,this.ctx.clearRect(0,0,this.width,this.height),this.render(this),this.cached=!0},Studio.DisplayList.prototype._cacheIt=function(){this.ctx.clearRect(0,0,this.width,this.height),this.render(this)},Studio.DisplayList.prototype.updateElement=function(t){t.render(this)},Studio.DisplayList.prototype.clearCachedElement=function(t){this.ctx.clearRect(t._x-t.width/2,t._y-t.height/2,t.width,t.height)},Studio.DisplayList.prototype.markedForRemoval=function(t){this.marked[this.marked.length]=t},Studio.DisplayList.prototype.removeMarked=function(){for(var t=0;t!=this.marked.length;t++)this.marked[t]&&this.clearCachedElement(this.marked[t]),this.marked[t]=null;this.marked.lengh=0},Studio.DisplayList.prototype.deactivateCache=function(){this.cached=!1},Studio.DisplayList.prototype.update=function(t,i){this.marked.length&&this.removeMarked(),this.update_visibility(),this.update_scale(),this.update_dimensions(),this.update_xy(),this.update_speed();for(var e=this.first;e;)this.next=e.next,e.update(t,i),e=e.next||this.next;!this.cached&&this.autoCache&&this.ctx&&this.updateCache()},Studio.DisplayList.prototype.render=function(t,i){if(this.cached)this._alpha!==t.ctx.globalAlpha&&(t.ctx.globalAlpha=this._alpha),this.draw(t.ctx);else for(var e=this.first;e;)this.next=e.next,e._delta(i),e.render(t,i),e=e.next||this.next},Studio.DisplayList.prototype.add=function(t){return t.parent=this,this.length++,this.length<=1&&null===this.first&&null===this.last?(this.first=t,this.last=t,t.prev=null,this.length=1,t):(this.last.next=t,t.prev=this.last,this.last=t,t)},Studio.DisplayList.prototype.draw=function(t){t.drawImage(this.cache,0,0,this.cache.width,this.cache.height,this._x,this._y,this._width,this._height)},Studio.addTo(Studio.DisplayList.prototype,LinkedList.prototype),Studio.Plugin=function(t){this.init=null,this.options={},this.action=null,this.apply(t)},Studio.Plugin.constructor=Studio.Plugin,Studio.Plugin.prototype.apply=Studio.DisplayObject.prototype.apply,Studio.Plugin.prototype._options=function(t){for(var i in t)this.options[i]=t[i]},Studio.Rect=function(t){this.color=new Studio.Color(1,0,0,0),this.slice=new Studio.Box(10,0,0,0),t&&this.apply(t)},Studio.Rect.prototype=new Studio.DisplayObject,Studio.Rect.prototype.constructor=Studio.Rect,Studio.Rect.prototype.setTexture=function(t,i,e,s){},Studio.Rect.prototype.addVert=function(t,i,e,s,o,h){t._batch[t._count++]=i,t._batch[t._count++]=e,t._batch[t._count++]=this.color.r,t._batch[t._count++]=this.color.g,t._batch[t._count++]=this.color.b,t._batch[t._count++]=this.color.a,t._batch[t._count++]=o,t._batch[t._count++]=h},Studio.Rect.prototype.buildElement=function(t,i){this._delta(i),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._z,this.slice.left,this.slice.top),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._z,this.slice.right,this.slice.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._z,this.slice.left,this.slice.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._z,this.slice.right,this.slice.bottom)},Studio.Rect.prototype.buildTriangles=function(t,i){this._delta(i),this._boundingBox.get_bounds(this),this.addVert(t,this._boundingBox.left,this._boundingBox.top,this._z,this.slice.left,this.slice.top),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._z,this.slice.right,this.slice.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._z,this.slice.left,this.slice.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.top,this._z,this.slice.right,this.slice.top),this.addVert(t,this._boundingBox.left,this._boundingBox.bottom,this._z,this.slice.left,this.slice.bottom),this.addVert(t,this._boundingBox.right,this._boundingBox.bottom,this._z,this.slice.right,this.slice.bottom)},Studio.Rect.prototype.setStyle=function(t){this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Rect.prototype.prepAngled=function(t){(this._x||this._y)&&t.translate(this._x,this._y),t.rotate(this.angle||0),(1!==this._scaleX||1!==this._scaleY)&&t.scale(this._scaleX,this._scaleY)},Studio.Rect.prototype.drawAngled=function(t){t.save(),this.prepAngled(t),t.fillRect(-(this.width*this.anchorX),-(this.height*this.anchorY),this.width,this.height),t.restore()},Studio.Rect.prototype.draw=function(t,i){this.setStyle(t),this.setAlpha(t),this.angle?this.drawAngled(t):t.fillRect(this._dx-this._width*this.anchorX,this._dy-this._height*this.anchorY,this._width,this._height)},Studio.difference={},Studio.Rect.prototype.hitTestRect=function(t){return Studio.difference.height=this._height+t._height,Studio.difference.width=this._width+t._width,Studio.difference.x=this._x-this._width*this.anchorX-t._x-t._width*t.anchorX,Studio.difference.y=this._y-this._height*this.anchorY-t._y-t._height*t.anchorY,Studio.difference.x<0&&Studio.difference.y<=0&&Studio.difference.height+Studio.difference.y>=0&&Studio.difference.width+Studio.difference.x>=0?!0:!1},Studio.Image=function(t){this.image=new Image,this.path=t,this.ready=!1,this.height=1,this.width=1,t&&this.loadImage(t)},Studio.Image.prototype.constructor=Studio.Image,Studio.Image.prototype.loadImage=function(t){if(Studio.assets[t])return console.warn("Already loaded : ",t,Studio.assets[t]),this.image=Studio.assets[t],this.ready=!0,this.onLoadComplete&&this.onLoadComplete(),this;Studio.assets[t]=new Image,Studio.assets.length++;var i=this;Studio.assets[t].onload=function(){return Studio.queue++,Studio.progress=Studio.queue/Studio.assets.length,i.ready=!0,i.height=this.height,i.width=this.width,Studio.queue===Studio.assets.length&&(Studio.loaded=!0),i.onLoadComplete&&i.onLoadComplete(),i},Studio.assets[t].src=t,this.image=Studio.assets[t]},Studio.Sprite=function(t){this.image=null,this.color=new Studio.Color(1,1,1,1),this.slice=new Studio.Box(0,0,1,1),this._boundingBox=new Studio.Box,t&&this.apply(t)},Studio.Sprite.prototype=new Studio.Rect,Studio.Sprite.prototype.constructor=Studio.Sprite,Studio.Sprite.prototype.drawRotated=function(t){t.save(),this.prepAngled(t),t.drawImage(this.image.image,0,0,this.image.width,this.image.height,-(this.width*this.anchorX),-(this.height*this.anchorY),this.width,this.height),t.restore()},Studio.Sprite.prototype.draw=function(t,i){this.image&&this.image.ready&&(this.setAlpha(t),this.angle?this.drawRotated(t):t.drawImage(this.image.image,0,0,this.image.width,this.image.height,this._dx-this._width*this.anchorX,this._dy-this._height*this.anchorY,this._width,this._height))},Studio.ImageSlice=function(t){this.image=null,this.rect={x:0,y:0,height:32,width:32},t&&this.apply(t)},Studio.ImageSlice.prototype=new Studio.Sprite,Studio.ImageSlice.prototype.constructor=Studio.ImageSlice,Studio.ImageSlice.prototype.draw=function(t){this.image&&this.image.ready&&(this.setAlpha(t),t.drawImage(this.image.image,this.rect.x,this.rect.y,this.rect.width,this.rect.height,this._dx-this._width*this.anchorX,this._dy-this._height*this.anchorY,this._width,this._height))},Studio.SpriteAnimation=function(t){this.sheet=new Studio.SpriteSheet,this.loop=[[0,0]],this.fps=12,this.frame=0,this.sliceX=0,this.sliceY=0,this.repeat=!0,this.startTime=0,t&&this.apply(t),this.setStartingFrame(this.frame)},Studio.SpriteAnimation.prototype=new Studio.Rect,Studio.SpriteAnimation.prototype.constructor=Studio.SpriteAnimation,Studio.SpriteAnimation.prototype.setStartingFrame=function(t){this.frame=t,this.startTime=Studio.time,this.myTime=this.startTime+t*(1e3/this.fps)},Studio.SpriteAnimation.prototype.draw=function(t,i){this.sheet&&this.sheet.ready&&(this.setAlpha(t),t.drawImage(this.sheet.image,this.sheet.rect.width*this.sliceX,this.sheet.rect.height*this.sliceY,this.sheet.rect.width,this.sheet.rect.height,this._dx-this._width*this.anchorX,this._dy-this._height*this.anchorX,this._width,this._height),this.loop.length&&this.updateFrame())},Studio.SpriteAnimation.prototype.setSlice=function(){this.sliceX=this.loop[this.frame][0],this.sliceY=this.loop[this.frame][1]},Studio.SpriteAnimation.prototype.updateFrame=function(){this.myTime+=Studio.delta,this.frame=(this.myTime-this.startTime)*this._speed/(1e3/this.fps)|0,this.frame>=this.loop.length&&(this.startTime=this.myTime,this.frame=0,this.onLoopComplete&&this.onLoopComplete.call(this)),this.setSlice()},Studio.SpriteSheet=function(t,i){this.image=new Studio.Image,this.rect={height:32,width:32},t&&this.loadImage(t),i&&this.apply(i)},Studio.SpriteSheet.prototype=new Studio.Image,Studio.SpriteSheet.prototype.constructor=Studio.SpriteSheet,Studio.SpriteSheet.prototype.apply=function(t){for(var i=Object.keys(t),e=i.length,s;e;)s=i[e-1],this[s]=t[s],e--},Studio.Camera=function(t){this.stage={width:t.width,height:t.height},this.tracking=null,this.bound=null,this.active=!0},Studio.Camera.prototype=new Studio.DisplayObject,Studio.Camera.prototype.constructor=Studio.Camera,Studio.Camera.prototype.updateRect=function(){this.left=this.bound._x,this.top=this.bound._y,this.right=this.bound._width*this.scaleX-this.stage.width,this.bottom=this.bound._height*this.scaleY-this.stage.height},Studio.Camera.prototype.update=function(t){this.tracking&&(this.x=this.tracking._x*this.scaleX-this.stage.width/2,this.y=this.tracking._y*this.scaleY-this.stage.height/2),this.bound&&(this.updateRect(),this.x<this.left?this.x=this.left:this.x>this.right&&(this.x=this.right),this.y<this.top?this.y=this.top:this.y>this.bottom&&(this.y=this.bottom))},Studio.Camera.prototype.render=function(t){(this.x||this.y||1!==this.scaleX||1!==this.scaleY)&&t.ctx.setTransform(t.ctx.resolution*this.scaleX,0,0,t.ctx.resolution*this.scaleY,-this.x*t.ctx.resolution,-this.y*t.ctx.resolution)},Studio.Camera.prototype.track=function(t){this.tracking=t},Studio.Camera.prototype.bindTo=function(t){this.bound=t},Studio.Camera.prototype.unBind=function(){this.bindTo(null)},Studio.Camera.prototype.stopTracking=function(){this.track(null)},Studio.Scene=function(t){this.color=null,this.active=!1,this.image=null,this.loader=null,this.assets=[],this.children=[],t&&this.apply(t),this.build&&this.build(),this.init&&this.init()},Studio.Scene.prototype=new Studio.DisplayObject,Studio.Scene.prototype.constructor=Studio.Scene,Studio.Scene.prototype.loadAssets=function(){for(var t=0;t!==arguments.length;t++)this.assets.push(new Studio.Image(arguments[t]))},Studio.Scene.prototype.setStyle=function(t){this.color!==t.fillStyle&&(t.fillStyle=this.color.style)},Studio.Scene.prototype.draw=function(t){return this.setAlpha(t),this.image?void t.drawImage(this.image.image,this._x,this._y,this.width,this.height):this.color?0===this.color.a?void t.clearRect(0,0,this.width,this.height):(this.setStyle(t),void t.fillRect(0,0,this.width,this.height)):void 0},Studio.Stage=function(t,i){return this.webgl=!1,this.color=new Studio.Color(0,0,0,1),i&&this.apply(i),this._getCanvasElement(t),this._count=0,this._maxCount=16050,this.dur=1e3/60,this._d=0,i&&this.apply(i),this._sizeCanvas(),this.setPixelRatio(1),this.webgl&&(this.engine=Studio.Stage.prototype.WEBGL),this.allowPlugins(),this.engine.getContext.call(this),this.engine.init.call(this,this.ctx),this.engine.prep.call(this,this.ctx),this.render=this.engine.render,this._init(),console.log("%cStudio3 v"+Studio.version+"%c"+this.engine.type,Studio.infoStyle,Studio.engineStyle),this.verts=0,this},Studio.Stage.prototype=new Studio.Scene,Studio.Stage.prototype.constructor=Studio.Stage,Studio.Stage.prototype._getCanvasElement=function(t){if(t)this.canvas=document.getElementById(t);else{var i=document.body.getElementsByTagName("canvas");i[0]?this.canvas=i[0]:(this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas))}},Studio.Stage.prototype.setColor=function(t,i,e,s){this.color.set(t,i,e,s),this.ctx.clearColor&&this.ctx.clearColor(this.color.r,this.color.g,this.color.b,this.color.a)},Studio.Stage.prototype._init=function(t){return this.ready=!1,this.autoPause=!1,this._watching=!1,this.children=[],this.buttons=[],this.activeScene=null,this.previousScene=null,this.camera=new Studio.Camera(this),this.tweens=Object.create(null),this.tween_length=0,this.nextID=0,this.anchorX=0,this.anchorY=0,this.active=!0,this._pause_buttons=!1,Studio.stage=this,this},Studio.Stage.prototype.allowPlugins=function(t){this.plugins=Object.create(null),this.plugins.input=[],this.plugins.effect=[],this._effects=0},Studio.Stage.prototype._sizeCanvas=function(t){this.height=this.canvas.height,this.width=this.canvas.width,this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this._scaleRatio=1},Studio.Stage.prototype.pauseButtons=function(t){this._pause_buttons=t},Studio.Stage.prototype.setPixelRatio=function(t){this.resolution=t||window.devicePixelRatio,this.canvas.width=this.width*this.resolution,this.canvas.height=this.height*this.resolution},Studio.Stage.prototype.fillScreen=function(t){},Studio.Stage.prototype.addInput=function(t){this.plugins.input.push(t)},Studio.Stage.prototype.addEffect=function(t,i){i&&t._options(i),t.init(this),this.plugins.effect.push(t),this._effects++},Studio.Stage.prototype.checkDataAttributes=function(){},Studio.Stage.prototype.setScene=function(t){t.parent=this,this.activeScene&&2===Studio.progress&&this.activeScene.onDeactivate&&this.activeScene.onDeactivate(),this.previousScene=this.activeScene,this.activeScene=t,this.activeScene.active=!0,t.onActivate&&t.onActivate()},Studio.Stage.prototype.watch=function(t){this._watching=t,this.children=t.children,this.hasChildren=t.hasChildren},Studio.Stage.prototype.addButton=function(t){this.buttons.unshift(t)},Studio.Stage.prototype.update_children=function(t,i){for(this.i=0;this.i!==this.hasChildren;this.i++)this.children[this.i].active&&this.children[this.i].update(t,i)},Studio.Stage.prototype.render_children=function(t){for(this.i=0;this.i!==this.hasChildren;this.i++)this.children[this.i].active&&this.children[this.i].render(this,t)},Studio.Stage.prototype.update_visibility=function(){this._alpha=this.alpha},Studio.Stage.prototype.update=function(t,i){this.update_tweens(),this.onEnterFrame&&this.onEnterFrame(),this._width=this.width,this._height=this.height,this._scaleX=this.scaleX,this._scaleY=this.scaleY,this._speed=this.camera.speed,this.update_visibility(),2===Studio.progress&&(this.activeScene&&this.activeScene.update(t,i),this.previousScene&&this.previousScene.active&&this.previousScene.update(t,i),(this.hasChildren||this._watching)&&this.update_children(),this.beforeDraw&&this.beforeDraw())},Studio.Stage.prototype.runEffects=function(t){for(this.i=0;this.i!==this._effects;this.i++)this.plugins.effect[this.i].action(this)},Studio.Stage.prototype.loading=function(t){1==Studio.loaded&&(this.onReady&&this.onReady(t),this.loop=this.activeloop)},Studio.Stage.prototype.activeloop=function(t){if(2===Studio.progress)return this.timeStep(t),void(this._effects&&this.runEffects(t));if(1===Studio.progress){if(this.onReady&&this.onReady(t),Studio.progress=2,!this.activeScene)return;this.activeScene.onActivate&&this.activeScene.onActivate()}},Studio.Stage.prototype.loop=Studio.Stage.prototype.loading,Studio.Stage.prototype.drawProgress=function(t){t.setTransform(t.resolution1,0,0,t.resolution,0,0),this.progressBar(t,Studio.progress),t.restore()},Studio.Stage.prototype.progressBar=function(t,i){t.fillStyle="rgba(255,255,255,.8)",t.fillRect((this.width-202)/2,(this.height-22)/2,202,22),t.fillStyle="rgba(0,0,0,1)",t.fillRect(2+(this.width-202)/2,2+(this.height-22)/2,198*i,18)};var FRAGMENTSHADER=["precision lowp float;","uniform sampler2D u_image;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","   if(v_texture.x==10.0){","		gl_FragColor = v_color;","	}else{","		gl_FragColor = texture2D(u_image, v_texture) * v_color;","	}","}"].join("\n"),VERTEXSHADER=["attribute vec3 a_position;","attribute vec4 a_color;","attribute vec2 a_texture;","uniform vec2 u_resolution;","varying vec4 v_color;","varying vec2 v_texture;","void main(void) {","	vec2 canvas_coords = ((vec2(a_position.x,a_position.y)/ u_resolution)*2.0) - 1.0;","	gl_Position = vec4(canvas_coords * vec2(1.0,-1.0), a_position.z, 1.0);","	v_color = a_color;","	v_texture = a_texture;","}"].join("\n");Studio.Stage.prototype.loadShader=function(t,i){this.ctx.shaderSource(t,i)},Studio.Stage.prototype.WEBGL={type:"webgl",antialias:!1,premultipliedAlpha:!1,stencil:!0,getContext:function(){this.ctx=this.canvas.getContext("webgl",{antialias:this.WEBGL.antialias,premultipliedAlpha:this.WEBGL.premultipliedAlpha,stencil:this.WEBGL.stencil})},init:function(t){t._count=0,t._batch=new Float32Array(523360),t.clearColor(this.color.r,this.color.g,this.color.b,this.color.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.vertexShader=t.createShader(t.VERTEX_SHADER),this.loadShader(this.vertexShader,VERTEXSHADER),t.compileShader(this.vertexShader),this.fragmentShader=t.createShader(t.FRAGMENT_SHADER),this.loadShader(this.fragmentShader,FRAGMENTSHADER),t.compileShader(this.fragmentShader),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.BLEND),this.program=t.createProgram(),t.attachShader(this.program,this.vertexShader),t.attachShader(this.program,this.fragmentShader),t.linkProgram(this.program),t.useProgram(this.program),this.buffer=t.createBuffer()},prep:function(t){t.resolutionLocation=t.getUniformLocation(this.program,"u_resolution"),t.enableVertexAttribArray(0),t.positionLocation=t.getAttribLocation(this.program,"a_position"),t.bindAttribLocation(this.program,0,"a_position"),t.colorLocation=t.getAttribLocation(this.program,"a_color"),t.textureLocation=t.getAttribLocation(this.program,"a_texture"),t.uniform2f(t.resolutionLocation,this.width,this.height),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.enableVertexAttribArray(t.positionLocation),t.enableVertexAttribArray(t.colorLocation),t.enableVertexAttribArray(t.textureLocation),t.vertexAttribPointer(t.positionLocation,2,t.FLOAT,!1,32,0),t.vertexAttribPointer(t.colorLocation,4,t.FLOAT,!1,32,8),t.vertexAttribPointer(t.textureLocation,2,t.FLOAT,!1,32,24),this._rect_index_buffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),this._rect_index=new Uint16Array(6*this._maxCount);for(var i=0,e=0;i<6*this._maxCount;i+=6,e+=4)this._rect_index[i+0]=e+0,this._rect_index[i+1]=e+1,this._rect_index[i+2]=e+2,this._rect_index[i+3]=e+1,this._rect_index[i+4]=e+2,this._rect_index[i+5]=e+3;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._rect_index_buffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,this._rect_index,t.STATIC_DRAW),this._r_count=0},render:function(t){this.ctx._count=0,this.vertex_children(this.ctx,t),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,this.ctx._batch,this.ctx.DYNAMIC_DRAW),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT|this.ctx.DEPTH_BUFFER_BIT),this.ctx.drawElements(this.ctx.TRIANGLES,6*this.hasChildren,this.ctx.UNSIGNED_SHORT,0)}},Studio.Stage.prototype.CANVAS={type:"2dContext",getContext:function(t){this.ctx=this.canvas.getContext("2d")},init:function(t){},prep:function(t){},render:function(t){this.draw(this.ctx),this.camera.active&&(this.camera.update(this),this.camera.render(this)),this.activeScene&&(this.activeScene.beforeDraw&&this.activeScene.beforeDraw(),this.activeScene.render(this,t)),this.previousScene&&this.previousScene.active&&this.previousScene.render(this,t),this.hasChildren&&this.render_children(t)}},Studio.fixedTimeStep=function(t){this.step(t),this.render(this._lag),this.fixedStep()},Studio.simple=function(t){this.render(1),this.update()},Studio.Stage.prototype.timeStep=Studio.fixedTimeStep,Studio.Stage.prototype.fixedStep=function(){for(;this._d>=this.dur;)this._d-=this.dur,this.update()},Studio.Stage.prototype.step=function(t){this._d+=t,this._lag=this._d/this.dur},Studio.Stage.prototype.engine=Studio.Stage.prototype.CANVAS,Studio.Stage.prototype.update_tweens=function(){var t,i=0,e,s,o;for(t in this.tweens)if(e=this.tweens[t],e.cur+=Studio.delta*e.actor._speed,o=e.dir?1-e.cur/e.duration:e.cur/e.duration,1>o&&o>0)for(i=0;i!==e.keys.length;i++)s=e.keys[i],this.update_property(e,s,o);else{if(e.loop)return e.cur=0,void(e.reflect&&(e.dir?e.dir=0:e.dir=1));e.reset?e.actor.apply(e.original):e.actor.apply(e.to),e.callback&&e.callback.call(e.actor),e=null,this.tweens[t]=null,delete this.tweens[t]}},Studio.Stage.prototype.update_property=function(t,i,e){t.actor[i]=t.original[i]+Studio.Ease[t.ease](e)*(t.to[i]-t.original[i])},Studio.Stage.prototype.createTween=function(t,i,e,s,o){var h={actor:t,ease:i,original:{},to:e,cur:0,duration:s,callback:o,loop:!1,reflect:!0,reset:!1,dir:0,id:this.nextID,keys:Object.keys(e)};h.apply=function(t){for(var i in t)this[i]=t[i];return this};for(var n in e)h.original[n]=t[n];return this.nextID++,h},Studio.Stage.prototype.createLoop=function(t,i,e,s,o){return this.tweens[this.nextID]=this.createTween(t,i,e,s,o),this.tweens[this.nextID-1].loop=!0,this.tweens[this.nextID-1]},Studio.Stage.prototype.addTween=function(t,i,e,s,o){return this.tweens[this.nextID]=this.createTween(t,i,e,s,o),this.tweens[this.nextID-1]},Studio.Stage.prototype.playTween=function(t){t.cur=0;for(var i=0;i!==t.keys.length;i++)t.original[t.keys[i]]=t.actor[t.keys[i]];this.tweens[t.id]=t},Studio.Stage.prototype.stopTween=function(t){if(this.tweens[t.id]){t.cur=0;for(var i=0;i!==t.keys.length;i++)t.actor[t.keys[i]]=t.original[t.keys[i]];this.tweens[t.id]=null,delete this.tweens[t.id]}},Studio.Ease={},Studio.Ease.linear=function(t){return t},Studio.Ease.snap=function(t){return Math.round(t)},Studio.Ease.backOut=function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},Studio.Ease.bounceOut=function(t){
return.363636>t?7.5625*t*t:.727272>t?7.5625*(t-=.545454)*t+.75:.90909>t?7.5625*(t-=.818181)*t+.9375:7.5625*(t-=.959595)*t+.984375},Studio.Ease.elasticOut=function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||1>e?(e=1,i=s/4):i=s*Math.asin(1/e)/6.283,e*Math.pow(2,-10*t)*Math.sin(6.283*(t-i)/s)+1)},Studio.Ease.linearRandom=function(t){return Math.random()*t},Studio.Ease.random=function(){return Math.random()},Studio.Ease.quadIn=function(t){return t*t},Studio.Ease.quadOut=function(t){return t*(2-t)},Studio.Ease.quadInOut=function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Studio.Font=function(t,i,e,s,o,h){this.clipHeight=i*s||1,this.clipWidth=e*s||1,this.resolution=s||1,this.charSet={},this.sheetWidth=o||26,this.loadImage(t),this._c=h||"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789.:;, ",this.createSet(this._c)},Studio.Font.prototype=new Studio.Image,Studio.Font.prototype.constructor=Studio.Font,Studio.Font.prototype.createSet=function(t){Studio._font_chars_length=t.length;for(var i=0;i!==Studio._font_chars_length;i++)this.charSet[t[i]]=i/this.sheetWidth},Studio.TextBox=function(t,i,e){this.font=null,this.lineHeight=10,this.image=document.createElement("canvas"),this.height=300,this.width=t,this.shadow=!0,this.image.height=i*e.resolution||256,this.image.width=t*e.resolution||256,this._buffer=this.image.getContext("2d"),this._buffer.imageSmoothingEnabled=!1,this._buffer.scale(e.resolution,e.resolution),this._buffer.textBaseline="top",this._buffer.font=this.font,this.text="",this.maxWidth=300,this.color="#fff",this._wrap_height=this.lineHeight,this.centered=!1},Studio.TextBox.prototype=new Studio.Rect,Studio.TextBox.prototype.constructor=Studio.TextBox,Studio.TextBox.prototype.setFont=function(t){return this.font=t,this},Studio.TextBox.prototype.setText=function(t){return this.text=t,this.reset(),this.wrapText(),this},Studio.TextBox.prototype.reset=function(){this._buffer.clearRect(0,0,this.image.width,this.image.height),this._buffer.font=this.font},Studio.TextBox.prototype.writeLine=function(t,i,e){this._buffer.fillStyle="rgba(0,0,0,.5)",this._buffer.fillText(t,i+1,e+this.lineHeight/2+2),this._buffer.fillStyle=this.color,this._buffer.fillText(t,i+1,e+this.lineHeight/2)},Studio.TextBox.prototype.wrapText=function(){for(var t=this.text.split(" "),i="",e=1,s=0,o=0;o<t.length;o++){var h=i+t[o]+" ",n=this._buffer.measureText(h),r=n.width;r>this.maxWidth&&o>0?(this.centered?this.writeLine(i,(this.maxWidth-r)/2,s):this.writeLine(i,e,s),i=t[o]+" ",s+=this.lineHeight):i=h}this.centered?this.writeLine(i,(this.maxWidth-r)/2,s):this.writeLine(i,e,s),this._wrap_height=s+this.lineHeight},Studio.TextBox.prototype.draw=function(t){this.setAlpha(t),t.drawImage(this.image,0,0,this.image.width,this.image.height,this._x,this._y,this._width,this._height)},Studio.Stage.prototype.enableKeyboardInput=function(){var t=this;this.keys={},this.canvas.onkeydown=function(i){i.preventDefault(),t.keys[i.keyCode]=1},this.canvas.onkeyup=function(i){i.preventDefault(),t.keys[i.keyCode]=0}},Studio.Stage.prototype.enableTouchEvents=function(){var t=this,i={x:0,y:0,dx:0,dy:0,id:0};this.mouse_onDown=function(t){if(this.buttons&&!this._pause_buttons)for(var i=0;i!=this.buttons.length;i++)if(this.buttons[i]._touchID);else if(this.buttons[i].hitTestPoint(t.x,t.y)){if(this.buttons[i]._touchID=t.id,this.buttons[i].onTap&&this.buttons[i].onTap(t),this.buttons[i].preventBubble)return}else this.buttons[i].onTapOutside&&this.buttons[i].onTapOutside(t)},this.mouse_onMove=function(t){if(this.buttons&&!this._pause_buttons)for(var i=0;i!=this.buttons.length;i++)this.buttons[i].hitTestPoint(t.x,t.y)?(this.buttons[i].draggable&&t.id&&this.buttons[i]._touchID==t.id&&(this.buttons[i]._activeDrag?this.buttons[i].onDrag&&this.buttons[i].onDrag(t):(this.buttons[i].onDragStart&&this.buttons[i].onDragStart(t),this.buttons[i]._activeDrag=!0)),this.buttons[i].onHoverStart&&!this.buttons[i].hovering?this.buttons[i].onHoverStart(t):this.buttons[i].onHover&&this.buttons[i].onHover(t),this.buttons[i].hovering=!0):this.buttons[i].hovering&&(this.buttons[i].hovering=!1,this.buttons[i].onHoverEnd&&this.buttons[i].onHoverEnd()),this.buttons[i].draggable&&this.buttons[i]._activeDrag&&this.buttons[i]._touchID==t.id&&(this.relativeX=t.dx,this.relativeY=t.dy,this.buttons[i].angle&&(this.buttons[i].orbits||this.buttons[i].inheritRotation)&&(this.relativeX=t.dx*Math.cos(-this.buttons[i].angle)-t.dy*Math.sin(-this.buttons[i].angle),this.relativeY=t.dx*Math.sin(-this.buttons[i].angle)+t.dy*Math.cos(-this.buttons[i].angle),t.dx=this.relativeX,t.dy=this.relativeY),this.buttons[i].onDrag&&this.buttons[i].onDrag(t)),this.buttons[i].onTouchMove&&this.buttons[i].onTouchMove(t)},this.mouse_onUp=function(t){if(this.buttons)for(var i=0;i!=this.buttons.length;i++)this.buttons[i]._touchID==t.id&&(this.buttons[i]._activeDrag&&this.buttons[i].onDragEnd&&this.buttons[i].onDragEnd(t),this.buttons[i].hitTestPoint(t.x,t.y)?this.buttons[i].onRelease&&this.buttons[i].onRelease(t):this.buttons[i].onReleaseOutside&&this.buttons[i].onReleaseOutside(t),this.buttons[i]._activeDrag=!1,this.buttons[i]._touchID=0)};var e={clientX:0,clientY:0},s=function(i){e.clientX=(i.clientX-t.canvas.offsetLeft)/t._scaleRatio,e.clientY=(i.clientY-t.canvas.offsetTop)/t._scaleRatio},o=function(o){s(o),i.id=1,i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,i.dx=i.dy=0,t.mouse_onDown(i)},h=function(o){s(o),i.dx=i.x-(e.clientX+t.camera.x),i.dy=i.y-(e.clientY+t.camera.y),i.x=e.clientX+t.camera.x,i.y=e.clientY+t.camera.y,t.mouse_onMove(i)},n=function(e){t.mouse_onUp(i),i.id=0};this._mouseWindow?(document.addEventListener("mousedown",o,!1),document.addEventListener("mousemove",h,!1),document.addEventListener("mouseup",n,!1),document.addEventListener("mouseout",n,!1)):(this.canvas.addEventListener("mousedown",o,!1),this.canvas.addEventListener("mousemove",h,!1),this.canvas.addEventListener("mouseup",n,!1),this.canvas.addEventListener("mouseout",n,!1));var r={},a=0,u=[],d={},c=0,l=function(i){i.preventDefault(),c=i.targetTouches.length;for(var o=0;o!=c;o++)a=i.targetTouches[o].identifier,s(i.targetTouches[o]),r[a]={},r[a].id=a,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,r[a].dx=0,r[a].dy=0,t.mouse_onDown(r[a])},p=function(i){i.preventDefault(),c=i.targetTouches.length;for(var o=0;o!=c;o++)a=i.targetTouches[o].identifier,s(i.targetTouches[o]),r[a].dx=r[a].x-e.clientX,r[a].dy=r[a].y-e.clientY,r[a].x=e.clientX+t.camera.x,r[a].y=e.clientY+t.camera.y,t.mouse_onMove(r[a])},g=function(i){i.preventDefault(),c=i.changedTouches.length;for(var e=0;e!=c;e++)a=i.changedTouches[e].identifier,t.mouse_onUp(r[a]),delete r[a]};window.ejecta?(document.addEventListener("touchstart",l,!1),document.addEventListener("touchmove",p,!1),document.addEventListener("touchend",g,!1),document.addEventListener("touchcancel",g,!1)):(this.canvas.addEventListener("touchstart",l,!1),this.canvas.addEventListener("touchmove",p,!1),this.canvas.addEventListener("touchend",g,!1),this.canvas.addEventListener("touchcancel",g,!1),this.canvas.setAttribute("tabindex","0"),this.canvas.focus())};